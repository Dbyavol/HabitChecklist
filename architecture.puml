@startuml
title HabitChecklist Architecture
skinparam monochrome true
skinparam shadowing false
skinparam packageStyle rectangle

package "UI Layer (Jetpack Compose)" {
  [MainActivity] as MainActivity
  [NavHost / NavRoutes] as NavHost
  [HabitListScreen] as HabitListScreen
  [AddHabitScreen] as AddHabitScreen
  [SettingsScreen] as SettingsScreen
  [HabitItem] as HabitItem
  [FeedbackDialog] as FeedbackDialog
  [AppTheme] as AppTheme
}

package "Domain Layer" {
  [HabitViewModel] as HabitViewModel
}

package "Data Layer" {
  [AppDatabase <<Room>>] as AppDatabase
  [HabitDao <<DAO>>] as HabitDao
  [Habit Entity] as HabitEntity
  [ThemePreferences <<DataStore>>] as ThemePreferences
}

package "Utils / Services" {
  [DateUtils] as DateUtils
  [ReminderScheduler] as ReminderScheduler
  [ReminderReceiver <<BroadcastReceiver>>] as ReminderReceiver
  [AppMetrics] as AppMetrics
  [FeedbackManager] as FeedbackManager
  [PermissionHelper] as PermissionHelper
}

package "System Services" {
  [AlarmManager] as AlarmManager
  [NotificationManager] as NotificationManager
  [SharedPreferences] as SharedPrefs
}

' Navigation flow
MainActivity --> NavHost
NavHost --> HabitListScreen
NavHost --> AddHabitScreen
NavHost --> SettingsScreen
HabitListScreen --> HabitItem
HabitListScreen --> FeedbackDialog

' UI to ViewModel
HabitListScreen --> HabitViewModel : observe habits\nmarkDone / delete
AddHabitScreen --> HabitViewModel : addHabit(name,\nreminder params)
HabitItem --> HabitViewModel : markDone / delete

' ViewModel to Data
HabitViewModel --> HabitDao : getAll / insert /\nupdate / delete
HabitViewModel --> ReminderScheduler : schedule / cancel
HabitViewModel --> DateUtils : isSameDay /\ndaysBetween
HabitViewModel --> AppMetrics : recordError

' Data layer
HabitDao --> AppDatabase
AppDatabase --> HabitEntity
SettingsScreen --> ThemePreferences : isDark / setDark
AppTheme --> ThemePreferences : isDark

' Reminder system
ReminderScheduler --> AlarmManager : setRepeating
ReminderScheduler --> ReminderReceiver : PendingIntent
ReminderReceiver --> NotificationManager : show notification

' Metrics and Feedback
MainActivity --> AppMetrics : initialize\nrecordSession\nrecordAppStartTime
HabitListScreen --> FeedbackManager : recordAction\nshouldShowFeedbackPrompt
SettingsScreen --> FeedbackManager : openFeedback\nopenRating
FeedbackDialog --> FeedbackManager : openFeedback / openRating
AppMetrics --> SharedPrefs : store metrics

' Permissions
MainActivity --> PermissionHelper : hasNotificationPermission\nrequestNotificationPermission

' Note about Habit Entity
note right of HabitEntity
Fields:
- id, name
- lastDone, streak, state
- reminderEnabled
- windowStartMinutes
- windowEndMinutes
- remindersPerDay
end note

' Note about AppMetrics
note right of AppMetrics
Tracks:
- Crash rate
- App start time
- Session count
- Error logs
end note

' Note about FeedbackManager
note right of FeedbackManager
Features:
- Periodic prompts
- Action tracking
- Email feedback
- Play Store rating
end note

@enduml
